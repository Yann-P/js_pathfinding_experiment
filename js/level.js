// Generated by CoffeeScript 1.3.3
(function() {

  define(['lib/jquery', 'lib/astar', 'data', 'zombie'], function($, AStar, Data, Zombie) {
    var Level;
    return Level = (function() {

      function Level(id, app) {
        var data;
        this.id = id;
        this.app = app;
        this.entityCount = 0;
        this.zombies = {};
        data = Data.store.levels[this.id];
        this.name = data.name;
        this.blocking = data.map.blocking;
        this.gold = data.initialGold;
        this.backgroundPath = "resources/img/maps/" + this.name + ".png";
        this.loadMap();
        this.addZombie();
      }

      Level.prototype.loadMap = function() {
        return document.getElementById('game').style.backgroundImage = "url('" + this.backgroundPath + "')";
      };

      Level.prototype.addZombie = function() {
        var _this = this;
        return setInterval(function() {
          var path, zombie;
          zombie = _this.zombies[_this.entityCount] = new Zombie(_this.entityCount, 'zombie_weak');
          zombie.setPosition(Math.floor(Math.random() * 29), Math.floor(Math.random() * 18));
          _this.entityCount++;
          path = AStar(_this.blocking, [zombie.x, zombie.y], [13, 9], "Manhattan");
          zombie.setMoveStack(path);
          return setTimeout(function() {
            return zombie.remove();
          }, 10000);
        }, 250);
      };

      return Level;

    })();
  });

}).call(this);
