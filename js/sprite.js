// Generated by CoffeeScript 1.3.3
(function() {

  define(['data'], function(Data) {
    var Sprite;
    Sprite = (function() {

      function Sprite(name, entity) {
        var data;
        this.name = name;
        this.entity = entity;
        this.currentAnimation = null;
        this.currentAnimationTicks = 0;
        this.currentAnimationTimeout = null;
        data = Data.store.sprites[this.name];
        this.nbFramesWidth = data.nbFramesWidth;
        this.frameWidth = data.width;
        this.frameHeight = data.height;
        this.filepath = data.filepath;
        this.animations = data.animations;
      }

      Sprite.prototype.setFrame = function(id) {
        var x, y;
        x = (id % this.nbFramesWidth) * 32;
        y = Math.floor(id / this.nbFramesWidth) * 32;
        return this.entity.setBackground(this.filepath, x, y);
      };

      Sprite.prototype.setAnimation = function(name) {
        this.stopAnimation();
        this.currentAnimation = this.animations[name];
        return this.tickAnimation();
      };

      Sprite.prototype.tickAnimation = function() {
        var frameid, frames,
          _this = this;
        frames = this.currentAnimation.frames;
        frameid = frames[this.currentAnimationTicks % frames.length];
        this.setFrame(frameid);
        this.currentAnimationTicks++;
        return this.currentAnimationTimeout = setTimeout(function() {
          return _this.tickAnimation();
        }, this.currentAnimation.interval || 100);
      };

      Sprite.prototype.stopAnimation = function() {
        this.currentAnimationTicks = 0;
        return clearTimeout(this.currentAnimationTimeout);
      };

      return Sprite;

    })();
    return Sprite;
  });

}).call(this);
